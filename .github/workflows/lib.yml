name: Skill Lab Library

on:
    push:
        branches: [main]
        paths:
            - "packages/skillreader/**"
            - "packages/analyzer/**"
            - "packages/shared/**"
            - ".github/workflows/lib.yml"
    pull_request:
        branches: [main]
        paths:
            - "packages/skillreader/**"
            - "packages/analyzer/**"
            - "packages/shared/**"
            - ".github/workflows/lib.yml"

jobs:
    test:
        name: Test & Lint (Lib + Shared)
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - uses: denoland/setup-deno@v2
              with:
                  deno-version: v2.x

            - name: Cache Deno dependencies
              uses: actions/cache@v4
              with:
                  path: |
                      ~/.cache/deno
                      ~/.deno
                  key: ${{ runner.os }}-deno-${{ hashFiles('**/deno.lock') }}

            - name: Shared checks
              run: deno task shared:check

            - name: Shared tests
              run: deno task shared:test

            - name: SkillReader checks
              run: deno task skillreader:check

            - name: SkillReader tests
              run: deno task skillreader:test

            - name: Analyzer checks
              run: deno task analyzer:check

            - name: Analyzer tests
              run: deno task analyzer:test

    build:
        name: Build Library (Placeholder)
        runs-on: ubuntu-latest
        needs: test
        steps:
            - uses: actions/checkout@v4

            - uses: denoland/setup-deno@v2
              with:
                  deno-version: v2.x

            - name: Cache Deno dependencies
              uses: actions/cache@v4
              with:
                  path: |
                      ~/.cache/deno
                      ~/.deno
                  key: ${{ runner.os }}-deno-${{ hashFiles('**/deno.lock') }}

            - name: Placeholder build step
              run: |
                  echo "TODO: build skill-lab npm package (skillreader + analyzer)"
